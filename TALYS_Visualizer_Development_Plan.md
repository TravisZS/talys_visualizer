# TALYS Visualizer 开发计划

## 项目概述
开发一个桌面应用程序，将TALYS核反应计算代码的所有功能进行可视化。

### 设计原则
1. **严格遵循TALYS默认值** - 不提供"智能建议"，所有参数默认值来自TALYS源代码
2. **分层界面设计** - 基础模式、高级模式、专家模式
3. **完整功能覆盖** - 支持TALYS的所有主要功能
4. **桌面应用** - 使用PyQt6，不考虑Web版本

## 技术栈
- **GUI框架**: PyQt6
- **绘图库**: Matplotlib, PyQtGraph
- **数据处理**: Pandas, NumPy
- **科学计算**: SciPy
- **TALYS接口**: 子进程调用 + 文件解析
- **编译打包**: Nuitka (编译为原生可执行文件)
- **安装包**: NSIS (Windows), AppImage (Linux), DMG (macOS)
- **CI/CD**: GitHub Actions 自动构建

## 开发阶段

### Phase 1: 基础架构 (4-6周)
**目标**: 建立项目基础框架和核心组件

#### Week 1-2: 项目初始化
- [x] 创建项目目录结构
- [x] 设置开发环境和依赖（conda环境）
- [x] 建立版本控制（Git + GitHub）
- [x] 创建基础GUI框架（主窗口可运行）

#### Week 3-4: TALYS接口开发
- [x] 实现TALYS可执行文件调用（测试通过）
- [x] 开发输入文件生成器（测试通过）
- [x] 实现输出文件解析器（基础完成）
- [x] 错误处理和日志系统（完成）

#### Week 5-6: 参数系统与GUI集成
- [x] 基础参数面板UI（完成）
- [x] GUI与TALYS接口集成（完成）
- [x] 多线程计算控制（完成）
- [ ] 从TALYS源代码提取所有默认参数
- [ ] 创建参数定义数据库
- [ ] 实现参数验证系统

### Phase 2: 核心可视化 (6-8周)
**目标**: 实现主要的数据可视化功能

#### Week 7-9: 截面可视化
- [ ] 总截面图表
- [ ] 分反应道截面
- [ ] 能量依赖性显示
- [ ] 交互式图表功能

#### Week 10-12: 输出文件管理与可视化
- [ ] 通用文件查看器（显示所有TALYS输出文件）
- [ ] 文本编辑器集成（点击查看文件内容）
- [ ] 重点文件可视化：
  - [ ] total.tot (总截面图)
  - [ ] *.spe (能谱图)
  - [ ] *.ang (角分布图)
- [ ] 文件导出和打印功能

#### Week 13-14: 高级可视化功能
- [ ] 交互式图表（缩放、平移、数据点查看）
- [ ] 多数据对比功能
- [ ] 图表样式自定义
- [ ] 数据表格显示（channels.out等）

### Phase 3: 高级功能 (4-6周)
**目标**: 实现完整的TALYS功能支持

#### Week 15-17: 核结构信息
- [ ] 能级图显示
- [ ] 能级密度可视化
- [ ] 光学模型参数显示
- [ ] 传输系数图表

#### Week 18-20: 特殊计算模式
- [ ] 天体物理学模式
- [ ] 裂变计算可视化
- [ ] 同位素产生计算
- [ ] 反冲计算显示

### Phase 4: 界面完善与打包 (4-5周)
**目标**: 完善用户界面、优化性能并实现跨平台打包分发

#### Week 21-22: 高级界面
- [x] 分层参数面板实现 (2025-08-25 完成)
- [ ] 多语言支持系统
- [ ] 模板系统
- [x] 专家模式编辑器 (基础版本完成)
- [ ] 项目管理功能

#### Week 23-24: 编译优化与测试
- [ ] 代码结构优化（适配Nuitka编译）
- [ ] 性能优化和内存管理
- [ ] 全面功能测试
- [ ] 跨平台兼容性测试

#### Week 25: 打包分发系统
- [ ] Nuitka编译配置优化
- [ ] 自动化构建脚本开发
- [ ] 安装包制作（Windows/Linux/macOS）
- [ ] CI/CD流水线设置
- [ ] 用户文档和安装指南

## 详细任务分解

### 1. 参数系统开发
```python
# 需要实现的核心类
class TalysParameterDatabase:
    """TALYS参数数据库，包含所有默认值"""
    
class ParameterValidator:
    """参数验证器"""
    
class InputFileGenerator:
    """TALYS输入文件生成器"""
```

### 2. 可视化组件
```python
# 主要可视化类
class CrossSectionPlot(QWidget):
    """截面图表组件"""
    
class SpectrumPlot(QWidget):
    """能谱图表组件"""
    
class AngularPlot(QWidget):
    """角分布图表组件"""
    
class LevelSchemePlot(QWidget):
    """能级图组件"""
```

### 3. 界面层次
```
基础模式: 必需参数 + 常用模型选择
高级模式: 分组的详细参数
专家模式: 原始输入文件编辑
```

## 里程碑检查点

### Milestone 1 (Week 6): 基础架构完成
- [ ] 能够调用TALYS并解析基本输出
- [ ] 基础GUI框架运行
- [ ] 参数系统基本功能

### Milestone 2 (Week 14): 核心可视化完成
- [ ] 主要图表类型都能显示
- [ ] 基础交互功能
- [ ] 数据导出功能

### Milestone 3 (Week 20): 功能完整
- [ ] 支持TALYS所有主要功能
- [ ] 高级界面实现
- [ ] 稳定性测试通过

### Milestone 4 (Week 25): 发布就绪
- [ ] 完整测试通过
- [ ] 用户文档完成
- [ ] 跨平台安装包制作完成
- [ ] 自动化构建流水线运行正常
- [ ] 首个正式版本发布

## 风险评估与应对

### 技术风险
1. **TALYS输出格式复杂** - 分阶段实现解析器
2. **GUI性能问题** - 使用高性能绘图库
3. **参数数量庞大** - 分层设计，逐步实现

### 时间风险
1. **功能范围过大** - 采用MVP方法，核心功能优先
2. **技术难点** - 预留缓冲时间
3. **测试时间不足** - 开发过程中持续测试

## 质量保证

### 代码质量
- 使用类型提示
- 编写单元测试
- 代码审查
- 文档字符串

### 用户体验
- 界面一致性
- 错误提示友好
- 响应速度优化
- 用户反馈收集

## 交付物

### 代码交付
- 完整源代码
- 单元测试
- 集成测试
- 性能测试

### 文档交付
- 用户手册
- 开发者文档
- API文档
- 安装指南

### 发布包
- Windows安装程序 (.exe)
- Linux AppImage (.AppImage)
- macOS应用包 (.dmg)
- 跨平台源码包
- 自动化构建系统
- GitHub Releases分发

## 最新进展 (2025-08-25)

### 🎉 重要里程碑：GUI分栏式重构完成
**完成时间**: 2025-08-25
**影响**: 界面设计重大升级，用户体验显著提升

#### 主要成就：
- ✅ **分栏式界面设计**：实现了类似XFresco的专业标签页布局
- ✅ **5个功能标签页**：基础参数、高级参数、输出选项、可视化、专家模式
- ✅ **空间利用率提升300%**：从1/4参数区域扩展到全窗口利用
- ✅ **参数同步机制**：完整的跨标签页参数管理系统
- ✅ **现代化UI风格**：专业的视觉设计和交互体验

#### 技术实现：
- 新增 `TabbedMainWindow` 主窗口类
- 实现 `ParameterSynchronizer` 参数同步器
- 创建 `BaseParameterTab` 标签页基类
- 5个专门的标签页组件完整实现
- 统一的样式系统和组件库

### 下一阶段重点：
- [ ] 多语言支持系统（英文为默认语言）
- [ ] 完善可视化标签页功能
- [ ] 集成现有TALYS计算接口
- [ ] 项目保存/加载功能
